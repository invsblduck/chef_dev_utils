<%# Be sure to put your .conf file in the same directory as this  -%>
<%# template file and name it by the same BASENAME.               -%>
<%#                                                               -%>
<%# Eg:                                                           -%>
<%#     $HOME/.chef/bootstrap/mytemplate.erb                      -%>
<%#     $HOME/.chef/bootstrap/mytemplate.conf                     -%>
<%#                                                               -%>
<%#  written by invsblduck <invsblduck \u0040 gmail \u002e com>   -%>
<%#                                                               -%>
bash -c '

apt-get update
apt-get -y install python-pip <%= Chef::Config[:knife][:t_packages] -%>

pip install python-swiftclient python-keystoneclient

export OS_AUTH_URL='<%= Chef::Config[:knife][:t_os_auth_url] %>'
export OS_USERNAME='<%= Chef::Config[:knife][:t_cf_username] %>'
export OS_PASSWORD='<%= Chef::Config[:knife][:t_os_password] %>'
export OS_TENANT_NAME='<%= Chef::Config[:knife][:t_os_tenant_name] %>'
export OS_REGION_NAME='<%= Chef::Config[:knife][:t_os_region_name] %>'

CONTAINER='<%= Chef::Config[:knife][:t_cf_container] %>'
TGZ_FILE='<%= Chef::Config[:knife][:t_cf_tarball] %>'

cd <%= Chef::Config[:knife][:t_working_dir] %>
swift download "$CONTAINER" "$TGZ_FILE"
tar xvzf "$TGZ_FILE"
<%= Chef::Config[:knife][:t_run_command] %>
'
